/**
 * Single Page Nav Plugin
 * Copyright (c) 2014 Chris Wojcik <cpw1485@gmail.com>
 * Dual licensed under MIT and GPL.
 * @author Chris Wojcik
 * @version 1.2.1
 */
"function" != typeof Object.create && (Object.create = function(a) {
        function b() {}
        return b.prototype = a, new b
    }),
    function(a, b, c, d) {
        "use strict";
        var e = {
            init: function(c, d) { this.options = a.extend({}, a.fn.singlePageNav.defaults, c), this.container = d, this.$container = a(d), this.$links = this.$container.find("a"), "" !== this.options.filter && (this.$links = this.$links.filter(this.options.filter)), this.$window = a(b), this.$htmlbody = a("html, body"), this.$links.on("click.singlePageNav", a.proxy(this.handleClick, this)), this.didScroll = !1, this.checkPosition(), this.setTimer() },
            handleClick: function(b) {
                var c = this,
                    d = b.currentTarget,
                    e = a(d.hash);
                b.preventDefault(), e.length && (c.clearTimer(), "function" == typeof c.options.beforeStart && c.options.beforeStart(), c.setActiveLink(d.hash), c.scrollTo(e, function() { c.options.updateHash && history.pushState && history.pushState(null, null, d.hash), c.setTimer(), "function" == typeof c.options.onComplete && c.options.onComplete() }))
            },
            scrollTo: function(a, b) {
                var c = this,
                    d = c.getCoords(a).top,
                    e = !1;
                c.$htmlbody.stop().animate({ scrollTop: d }, { duration: c.options.speed, easing: c.options.easing, complete: function() { "function" != typeof b || e || b(), e = !0 } })
            },
            setTimer: function() {
                var a = this;
                a.$window.on("scroll.singlePageNav", function() { a.didScroll = !0 }), a.timer = setInterval(function() { a.didScroll && (a.didScroll = !1, a.checkPosition()) }, 250)
            },
            clearTimer: function() { clearInterval(this.timer), this.$window.off("scroll.singlePageNav"), this.didScroll = !1 },
            checkPosition: function() {
                var a = this.$window.scrollTop(),
                    b = this.getCurrentSection(a);
                null !== b && this.setActiveLink(b)
            },
            getCoords: function(a) { return { top: Math.round(a.offset().top) - this.options.offset } },
            setActiveLink: function(a) {
                var b = this.$container.find("a[href$='" + a + "']");
                b.hasClass(this.options.currentClass) || (this.$links.removeClass(this.options.currentClass), b.addClass(this.options.currentClass))
            },
            getCurrentSection: function(d) {
                var e, f, g, h;
                for (e = 0; e < this.$links.length; e++) f = this.$links[e].hash, a(f).length && (g = this.getCoords(a(f)), d >= g.top - this.options.threshold && (h = f));
                var i = a(c).height() - a(b).height();
                if (d == i) {
                    var j = this.$links.length;
                    j > 0 && (h = this.$links[j - 1].hash)
                }
                return h || (0 === this.$links.length ? null : this.$links[0].hash)
            }
        };
        a.fn.singlePageNav = function(a) {
            return this.each(function() {
                var b = Object.create(e);
                b.init(a, this)
            })
        }, a.fn.singlePageNav.defaults = { offset: 0, threshold: 120, speed: 400, currentClass: "current", easing: "swing", updateHash: !1, filter: "", onComplete: !1, beforeStart: !1 }
    }(jQuery, window, document);

$(window).scroll(function() {
    if ($(this).scrollTop() > 100) {
        $('.logo').addClass('scroll-logo');
    } else {
        $('.logo').removeClass('scroll-logo');
    }
});

function getOffSet() {
    var _offset = 450;
    var windowHeight = window.innerHeight;

    if (windowHeight > 500) {
        _offset = 400;
    }
    if (windowHeight > 680) {
        _offset = 300
    }
    if (windowHeight > 830) {
        _offset = 210;
    }

    return _offset;
}

function setParallaxPosition($doc, multiplier, $object) {
    var offset = getOffSet();
    var from_top = $doc.scrollTop(),
        bg_css = 'center ' + (multiplier * from_top - offset) + 'px';
    $object.css({
        "background-position": bg_css
    });
}

// Parallax function
// Adapted based on https://codepen.io/roborich/pen/wpAsm        
var background_image_parallax = function($object, multiplier, forceSet) {
    multiplier = typeof multiplier !== 'undefined' ? multiplier : 0.5;
    multiplier = 1 - multiplier;
    var $doc = $(document);
    // $object.css({"background-attatchment" : "fixed"});

    if (forceSet) {
        setParallaxPosition($doc, multiplier, $object);
    } else {
        $(window).scroll(function() {
            setParallaxPosition($doc, multiplier, $object);
        });
    }
};

var background_image_parallax_2 = function($object, multiplier) {
    multiplier = typeof multiplier !== 'undefined' ? multiplier : 0.5;
    multiplier = 1 - multiplier;
    var $doc = $(document);
    $object.css({
        "background-attachment": "fixed"
    });
    $(window).scroll(function() {
        var firstTop = $object.offset().top,
            pos = $(window).scrollTop(),
            yPos = Math.round((multiplier * (firstTop - pos)) - 186);

        var bg_css = 'center ' + yPos + 'px';

        $object.css({
            "background-position": bg_css
        });
    });
};

$(function() {
    // Hero Section - Background Parallax
    background_image_parallax($(".tm-parallax"), 0.30, false);
    background_image_parallax_2($("#contact"), 0.80);

    // Handle window resize
    window.addEventListener('resize', function() {
        background_image_parallax($(".tm-parallax"), 0.30, true);
    }, true);

    // Detect window scroll and update navbar
    $(window).scroll(function(e) {
        if ($(document).scrollTop() > 120) {
            $('.tm-navbar').addClass("scroll");
        } else {
            $('.tm-navbar').removeClass("scroll");
        }
    });

    // Close mobile menu after click 
    $('#tmNav a').on('click', function() {
        $('.navbar-collapse').removeClass('show');
    })

    // Scroll to corresponding section with animation
    $('#tmNav').singlePageNav();

    // Add smooth scrolling to all links
    // https://www.w3schools.com/howto/howto_css_smooth_scroll.asp
    $("a").on('click', function(event) {
        if (this.hash !== "") {
            event.preventDefault();
            var hash = this.hash;

            $('html, body').animate({
                scrollTop: $(hash).offset().top
            }, 400, function() {
                window.location.hash = hash;
            });
        } // End if
    });

    // Pop up
    $('.tm-gallery').magnificPopup({
        delegate: 'a',
        type: 'image',
        gallery: {
            enabled: true
        }
    });

    // Gallery
    $('.tm-gallery').slick({
        dots: true,
        infinite: false,
        slidesToShow: 5,
        slidesToScroll: 2,
        responsive: [{
            breakpoint: 1199,
            settings: {
                slidesToShow: 4,
                slidesToScroll: 2
            }
        }, {
            breakpoint: 991,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 2
            }
        }, {
            breakpoint: 767,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 1
            }
        }, {
            breakpoint: 480,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1
            }
        }]
    });
});